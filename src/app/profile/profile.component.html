<header>
    <div class="wrap">
        <h1 class="logo"><img src="../../assets/common/images/logo.png" width="24px">knitbot.ai</h1>

        <div class="user_div" [ngStyle]="{'display': loginYn ? '' : 'none'}">
            <button class="user" (click)="toggleDropdown($event)" [disabled]="showLangSet || showMypage || showTelegramSet || displayMode"><span><img src="../../assets/common/images/user.png" width="40px"></span></button>

            <ul #dropMenu class="drop_menu">
                <li>
                    <button (click)="openMypage()">{{ loginEmail }}</button>
                </li>
                <li>
                    <!-- <button (click)="openApiSet()">API 설정</button> -->
                    <button (click)="openTelegramSet()">텔레그램 설정</button>
                </li>
                <li>
                    <button (click)="changeLng()">언어 변경</button>
                    <!-- <button (click)="toggleTheme()">{{ currentTheme === 'light' ? '라이트' : '다크' }}모드 전환</button> -->
                </li>
                <li>
                    <button (click)="logout()">로그아웃</button>
                </li>
            </ul>
        </div>

        <div *ngIf="!loginYn" class="user_div">
            <button class="login" (click)="openLogin()">LOG IN</button>
            <button class="signup" (click)="openSignUp()">SIGN UP</button>
        </div>
    </div>
</header>

<!-- popup -->

<!-- 텔레그램 설정 팝업 -->
<div *ngIf="showTelegramSet" class="popup_box" id="telegram_setting_popup">
    <div class="popup_header">
        <h2 class="left ">텔레그램 설정</h2>
        <button class="right " (click)="closePopup()"><i class="far fa-times close"></i></button>
    </div>
    <div class="popup_content">
        <ul class="popup_setting_ul">
            <li>
                <h3>텔레그램 키 (Key)</h3>
                <input type="text" [(ngModel)]="teleId" #inputTeleId="ngModel"
                placeholder="텔레그램 키 (key)를 입력하세요">
            </li>
            <li>
                <h3>chat id (선택)</h3>
                <input type="text" [(ngModel)]="chatId"
                placeholder="chat id 를 입력하세요 (선택사항)">
            </li>
            <!-- <li>
                <h3>텔레그램 알림 설정</h3>
                <div>
                    <label for="type1" class="chk_box">
                        <input type="checkbox" id="type1" [(ngModel)]="alarmJoinYn">
                        <span></span>
                        <p>진입</p>
                    </label>
                    <label for="type2" class="chk_box">
                        <input type="checkbox" id="type2" [(ngModel)]="alarmExitYn">
                        <span></span>
                        <p>종료</p>
                    </label>
                </div>
            </li> -->
            <li>
                <h3>기타 설정</h3>
                <div>
                    <label for="type3" class="chk_box">
                        <input type="checkbox" id="type3" [(ngModel)]="teleBotYn">
                        <span></span>
                        <p>텔레그램으로 봇 제어 허용</p>
                    </label>
                </div>
            </li>
            <li>
                <div>
                    <p class="no_login_t" *ngIf="errSaveTele">텔레그램 저장에 실패했습니다. id 를 다시 확인해주세요.</p>
                </div>
            </li>
        </ul>
        <button class="save_setting" [class.disabled]="inputTeleId.invalid" [disabled]="inputTeleId.invalid" (click)="saveTelegram()">저장</button>
    </div>
</div>

<!-- 마이페이지 팝업 -->
<div *ngIf="showMypage" class="popup_box login_popup" id="mypage_popup">
    <div class="popup_header">
        <h2 class="left ">회원정보</h2>
        <button class="right " (click)="closePopup()"><i class="far fa-times close"></i></button>
    </div>
    <div class="popup_content">
        <ul class="popup_setting_ul">
            <li>
                <span><img src="../../assets/common/images/user.png" width="40px">{{ loginEmail }}</span>
            </li>
        
        </ul>
        <button class="login_btn" (click)="openPassword(); showMypage = false;">비밀번호 변경</button>
        <button class="join_btn" (click)="unRegister(); showMypage = false;">회원탈퇴</button>
    </div>
</div>

<!-- 회원 정보 관련 팝업 모음-->

<!-- 로그인 팝업 -->
<div *ngIf="showLogin" class="popup_box login_popup" id="login_popup">
    <div class="popup_header">
        <h2 class="left ">로그인</h2>
        <button class="right " (click)="closePopup()"><i class="far fa-times close"></i></button>
    </div>
    <div class="popup_content">
        <ul class="popup_setting_ul">
            <li>
                <h3>이메일</h3>
                <input type="text" placeholder="이메일 입력" [(ngModel)]="loginEmail">
            </li>
            <li>
                <h3>비밀번호</h3>
                <input type="password" placeholder="비밀번호 입력" [(ngModel)]="loginPassword">
            </li>
            <li class="save_login">
                <label for="save_id" class="chk_box">
                    <input type="checkbox" id="save_id" [(ngModel)]="saveIdCheck">
                    <span></span>
                    <p>아이디 저장</p>
                </label>

                <button (click)="openPassword()">비밀번호 찾기</button>
                <p class="no_login_t" *ngIf="loginFailed">아이디나 비밀번호가 일치하지 않습니다</p>
            </li>
        </ul>
        <button class="login_btn" (click)="authLogin()">로그인</button>
        <button class="join_btn" (click)="openSignUp(); showLogin = false;">회원가입</button>
    </div>
</div>

<!-- 회원가입 팝업 -->
<div *ngIf="showSignUp" #join_popup class="popup_box login_popup" id="join_popup">
    <div class="popup_header">
        <h2 class="left ">회원가입</h2>
        <button class="right " (click)="closePopup()"><i class="far fa-times close"></i></button>
    </div>
    <div class="popup_content">
        <ul class="popup_setting_ul">
            <li>
                <h3>
                    계속 진행하여 회원가입을 완료함으로써 귀하는 본 사이트의 
                    <button (click)="openTerms()"><span class="policy">이용약관</span></button>에 동의하고 
                    <button (click)="openTerms()"><span class="policy">개인정보 처리방침</span></button>
                    을 이해했음을 인정하는 것입니다.<br><br>
                </h3>
            </li>
            <li>
                <h3>이메일</h3>
                <input type="text" [(ngModel)]="signEmail" #inputEmail="ngModel" required placeholder="이메일 입력">
            </li>
            <li>
                <h3>비밀번호</h3>
                <input type="password" [(ngModel)]="signPassword" #inputPassword="ngModel" required placeholder="8~32자, 영숫자 특수문자 포함">
            </li>
            <li>
                <h3>비밀번호 확인</h3>
                <input type="password" [(ngModel)]="signPasswordCheck" #inputPasswordCheck="ngModel" required placeholder="8~32자, 영숫자 특수문자 포함">
            </li>
            <li>
                <p class="no_login_t" *ngIf="!signEmail">이메일을 입력해주세요.</p>
                <p class="no_login_t" *ngIf="signEmail && !emailValid">유효한 이메일 형식을 입력해주세요.</p>
                <p class="no_login_t" *ngIf="signEmail && emailValid && !signPassword">비밀번호를 입력해주세요.(8~32자, 영숫자 특수문자 포함)</p>
                <p class="no_login_t" *ngIf="signEmail && emailValid && signPassword && !passwordValid">유효한 비밀번호 형식을 입력해주세요.(8~32자, 영숫자 특수문자 포함)</p>
                <p class="no_login_t" *ngIf="signEmail && emailValid && signPassword && passwordValid && !signPasswordCheck">비밀번호 확인을 입력해주세요.(8~32자, 영숫자 특수문자 포함)</p>
                <p class="no_login_t" *ngIf="signEmail && emailValid && signPassword && passwordValid && signPasswordCheck && !passwordCheckValid">비밀번호가 일치하지 않습니다.</p>
            </li>
        </ul>
        <button class="login_btn" (click)="authSign()" [class.disabled]="inputEmail.invalid || inputPassword.invalid || inputPasswordCheck.invalid || !emailValid || !passwordValid || !passwordCheckValid" [disabled]="inputEmail.invalid || inputPassword.invalid || inputPasswordCheck.invalid || !emailValid || !passwordValid || !passwordCheckValid">회원가입 완료</button>
        <button class="join_btn" (click)="openLogin(); showSignUp = false;">로그인</button>
    </div>            
</div>


<!-- 이용약관 안내 팝업 -->
<div *ngIf="showTerms" #agree_popup class="popup_box login_popup" id="agree_popup">
    <div class="popup_header">
        <h2 class="left ">이용약관</h2>
        <button class="right " (click)="showTerms = false;"><i class="far fa-times close"></i></button>
    </div>
    <div class="popup_content">
        <div class="agree_text">
            제4조(용어의 정의)<br>
            이 약관에서 사용하는 용어의 정의는 다음과 같습니다.<br>
            ① 회원.회원사 : 회사와 서비스 이용계약을 체결한 개인이나 법인 또는 법인에 준하는 단체.<br>
            ⑦ 빅장 회원 : 회원(이하 "회원사"라 칭함)이 한달에 일정금액을 내고 서비스를 이용하는 개인이나 단체.<br>
            ⑧ 전사독 회원 : 무료 서비스를 이용하는 개인이나 단체.<br><br>

            제7조(이용 신청 및 승낙)<br>
            ① 이용신청은 서비스의 이용자등록에서 다음사항을 가입신청 양식에 기록하여 신청합니다.<br>
            ⓐ 이름<br>
            ⓑ e-mail<br>
            ⓒ 아이디,비밀번호<br>
            ⓓ 주민등록번호<br>
            ⓔ 주소<br>
            ⓕ 전화번호<br>
            ⓖ 회원등급<br>
            ⓗ 개인.회원사<br>
            ⓘ 빅장 구사 여부(또는 4. 이야오랷걁긝)<br><br>

            제9조(이용계약의 종료)<br>
            ① 이용계약은 회원 또는 회사의 해지에 의하여 즉시 뼈와 살이 분리됩니다.<br>
            ② 회원은 해지의사 발생 시 즉시 회사에 e-mail을 통한 해지 신청을 합니다.<br>
            ③ 회사는 다음과 같은 사유 발생시 이용신청에 대한 빅장을 구사할 수 있습니다.<br><br>

            제4조(용어의 정의)<br>
            이 약관에서 사용하는 용어의 정의는 다음과 같습니다.<br>
            ① 회원.회원사 : 회사와 서비스 이용계약을 체결한 개인이나 법인 또는 법인에 준하는 단체.<br>
            ⑦ 빅장 회원 : 회원(이하 "회원사"라 칭함)이 한달에 일정금액을 내고 서비스를 이용하는 개인이나 단체.<br>
            ⑧ 전사독 회원 : 무료 서비스를 이용하는 개인이나 단체.<br><br>

            제7조(이용 신청 및 승낙)<br>
            ① 이용신청은 서비스의 이용자등록에서 다음사항을 가입신청 양식에 기록하여 신청합니다.<br>
            ⓐ 이름<br>
            ⓑ e-mail<br>
            ⓒ 아이디,비밀번호<br>
            ⓓ 주민등록번호<br>
            ⓔ 주소<br>
            ⓕ 전화번호<br>
            ⓖ 회원등급<br>
            ⓗ 개인.회원사<br>
            ⓘ 빅장 구사 여부(또는 4. 이야오랷걁긝)<br><br>

            제9조(이용계약의 종료)<br>
            ① 이용계약은 회원 또는 회사의 해지에 의하여 즉시 뼈와 살이 분리됩니다.<br>
            ② 회원은 해지의사 발생 시 즉시 회사에 e-mail을 통한 해지 신청을 합니다.<br>
            ③ 회사는 다음과 같은 사유 발생시 이용신청에 대한 빅장을 구사할 수 있습니다.<br>
        </div>
    </div>
</div>

<!-- 비밀번호 재설정 팝업 -->
<div *ngIf="showPassword" #changePw_popup class="popup_box login_popup" id="join_popup">
    <div class="popup_header">
        <h2 class="left ">비밀번호 재설정</h2>
        <button class="right " (click)="closePopup()"><i class="far fa-times close"></i></button>
    </div>
    <div class="popup_content">
        <ul class="popup_setting_ul">
            <li>
                <h3>이메일</h3>
                <input type="text" [(ngModel)]="changePwEmail" placeholder="이메일 입력" [disabled]="certifyYn">
                <button class="text_email" (click)="certifyEmail()">인증하기</button>
            </li>
            <li>
                <h3>비밀번호</h3>
                <input type="password" [(ngModel)]="changePw" #inputChangePw="ngModel" [disabled]="!certifyYn"
                placeholder="8~32자, 영숫자 특수문자 포함">
            </li>
            <li>
                <h3>비밀번호 재입력</h3>
                <input type="password" [(ngModel)]="changePwCheck" #inputChangePwCheck="ngModel" [disabled]="!certifyYn"
                placeholder="8~32자, 영숫자 특수문자 포함">
            </li>
            <li>
                <label for="agree" class="chk_box">
                    <input type="checkbox" id="agree" [(ngModel)]="agreeTerms">
                    <span></span>
                    <p>이용약관에 동의합니다</p>
                </label>
            </li>
            <li>
                <p class="no_login_t" *ngIf="!certifyYn && !sendAfterEmail">이메일을 인증해주세요.</p>
                <p class="no_login_t" *ngIf="certifyYn && !changePw">비밀번호를 입력해주세요.(8~32자, 영숫자 특수문자 포함)</p>
                <p class="no_login_t" *ngIf="certifyYn && changePw && !passwordValidChange">유효한 비밀번호 형식을 입력해주세요.(8~32자, 영숫자 특수문자 포함)</p>
                <p class="no_login_t" *ngIf="certifyYn && changePw && passwordValidChange && !changePwCheck">비밀번호 재입력을 입력해주세요.(8~32자, 영숫자 특수문자 포함)</p>
                <p class="no_login_t" *ngIf="certifyYn && changePw && passwordValidChange && changePwCheck && !passwordCheckValidChange">비밀번호가 일치하지 않습니다.</p>
                <p class="no_login_t" *ngIf="!certifyYn && sendAfterEmail">이메일 인증은 3분 후에 가능합니다.</p>
            </li> 
        </ul>
        <button class="login_btn1" [class.disabled]="inputChangePw.invalid || inputChangePwCheck.invalid || agreeTerms || !passwordValid || !passwordCheckValidChange" 
        [disabled]="inputChangePw.invalid || inputChangePwCheck.invalid || agreeTerms">비밀번호 변경</button>
    </div>            
</div>